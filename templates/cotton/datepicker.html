<c-vars 
    id=""
    name=""
    placeholder="Pick a date"
/>

<div 
    x-data="{
        open: false,
        selectedDate: null,
        currentMonth: new Date().getMonth(),
        currentYear: new Date().getFullYear(),
        
        get monthName() {
            const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
            return months[this.currentMonth];
        },
        
        get daysInMonth() {
            return new Date(this.currentYear, this.currentMonth + 1, 0).getDate();
        },
        
        get firstDayOfMonth() {
            return new Date(this.currentYear, this.currentMonth, 1).getDay();
        },
        
        selectDate(day) {
            this.selectedDate = new Date(this.currentYear, this.currentMonth, day);
            this.open = false;
        },
        
        formatDate(date) {
            if (!date) return '';
            return date.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
        },
        
        prevMonth() {
            if (this.currentMonth === 0) {
                this.currentMonth = 11;
                this.currentYear--;
            } else {
                this.currentMonth--;
            }
        },
        
        nextMonth() {
            if (this.currentMonth === 11) {
                this.currentMonth = 0;
                this.currentYear++;
            } else {
                this.currentMonth++;
            }
        }
    }"
    @click.away="open = false"
    class="relative"
    data-slot="datepicker"
    {{ attrs }}
>
    <button
        type="button"
        @click="open = !open"
        class="flex h-9 w-full items-center justify-between rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50"
    >
        <span x-text="selectedDate ? formatDate(selectedDate) : '{{ placeholder }}'"></span>
        <svg class="h-4 w-4 opacity-50" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M8 2v4M16 2v4M3 10h18M5 4h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2z"/>
        </svg>
    </button>
    
    <div 
        x-show="open"
        x-transition
        class="absolute z-50 mt-2 rounded-md border bg-popover p-3 shadow-md"
    >
        <div class="flex items-center justify-between mb-4">
            <button @click="prevMonth()" type="button" class="inline-flex items-center justify-center rounded-md text-sm font-medium h-7 w-7 hover:bg-accent">
                <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="m15 18-6-6 6-6"/>
                </svg>
            </button>
            <div class="text-sm font-medium" x-text="monthName + ' ' + currentYear"></div>
            <button @click="nextMonth()" type="button" class="inline-flex items-center justify-center rounded-md text-sm font-medium h-7 w-7 hover:bg-accent">
                <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="m9 18 6-6-6-6"/>
                </svg>
            </button>
        </div>
        
        <div class="grid grid-cols-7 gap-1 text-center text-sm">
            <div class="text-muted-foreground font-medium">Su</div>
            <div class="text-muted-foreground font-medium">Mo</div>
            <div class="text-muted-foreground font-medium">Tu</div>
            <div class="text-muted-foreground font-medium">We</div>
            <div class="text-muted-foreground font-medium">Th</div>
            <div class="text-muted-foreground font-medium">Fr</div>
            <div class="text-muted-foreground font-medium">Sa</div>
            
            <template x-for="blank in firstDayOfMonth" :key="'blank-' + blank">
                <div></div>
            </template>
            
            <template x-for="day in daysInMonth" :key="day">
                <button
                    type="button"
                    @click="selectDate(day)"
                    class="h-8 w-8 rounded-md text-sm hover:bg-accent"
                    :class="{ 'bg-primary text-primary-foreground': selectedDate && selectedDate.getDate() === day && selectedDate.getMonth() === currentMonth && selectedDate.getFullYear() === currentYear }"
                    x-text="day"
                ></button>
            </template>
        </div>
    </div>
    
    <input 
        type="hidden" 
        {% if id %}id="{{ id }}"{% endif %}
        {% if name %}name="{{ name }}"{% endif %}
        :value="selectedDate ? selectedDate.toISOString().split('T')[0] : ''"
    />
</div>
